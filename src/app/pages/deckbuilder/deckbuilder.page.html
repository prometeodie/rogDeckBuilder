<ion-header>
<ion-toolbar [style.--background]="getGradient()">


    <!-- back -->
   <ion-icon
  slot="start"
  name="arrow-back-outline"
  class="icon icon-l"
  routerLink="/home"
  (click)="$event.stopPropagation()">
</ion-icon>

    <!-- título editable -->
    <div class="editable-title">

      @if (!editingTitle) {
        <ion-title
          class="title-centered"
          (click)="enableEdit()">
          {{ deckName || 'Deck Builder' |titlecase }}
        </ion-title>
      }

      @if (editingTitle) {
        <ion-input
          class="title-input"
          [value]="deckName"
          (ionInput)="deckName = $any($event.target).value"
          (ionBlur)="saveTitle()"
          (keyup.enter)="saveTitle()"
          autofocus="true"
          maxlength="24">
        </ion-input>
      }

    </div>

    <!-- buscar -->
    <ion-icon
      name="search-outline"
      slot="end"
      class="icon"
      (click)="toggleSearch($event)">
    </ion-icon>
  </ion-toolbar>

  <!-- sticky nav -->
  <div class="sticky-nav">
    <div class="nav-items">
   @for (sello of sellos; track $index) {
  <img
    class="nav-item"
    [src]="'../../../assets/SELLOS/' + sello.img"
    (click)="filterCardsByFaction(sello.faction)"
    [alt]="sello.faction"
    [class.selected]="selectedFaction === sello.faction"
  >
}
    </div>
  </div>
</ion-header>

@if (searchOpen) {
 <div class="searchbar-container">
  <ion-searchbar
    show-clear-button="always"
    placeholder="Buscar..."
    class="searchbar"
    (ionInput)="filterCards($any($event.target).value)"
    (ionKeydown)="onSearchKeydown($event)" ?/>
</div>

}

@if (viewImg) {
  <image-viewer [img]="imgSelected" (closeViewer)="toggleImageViewer()" />
}

<ion-content class="deck-layout" (click)="closeSearch()">
  <div class="main-container">

 <side-bar
  [deckMode]="deckMode()"
  [totalSelected]="totalSelected"
  [selectedCards]="selectedCards"
  [savedAmounts]="savedAmounts"
  [deckId]="deckId()!"

  (setMode)="setDeckMode($event)"
  (removeCard)="removeCard($event)"
  (sortChanged)="applySorting($event)"/>

    <div class="content-area" >
      <h2 class="faction-selected">{{selectedFactionTitle | titlecase}}</h2>
      <div class="cards-wrapper">
        <div class="cards-container"#cardsContainer>
          @if (currentCards.length > 0) {
          @for (card of currentCards; track card.id) {
            <card
              class="card"
              [deckId]="deckId()!"
              [cardData]="card"
              [mode]="deckMode()"
              [initialCount]="savedAmounts[card.id] ?? 0"
              (ImgView)="openImageViewer($event)"
              (amountChange)="refreshDeck()">
            </card>
          }
        }

        <!-- not found -->
        @if (currentCards.length === 0 && searchTerm) {
          <div class="no-results">
              <h3>No se encontró ninguna carta... :C</h3>
          </div>
        }
        </div>
      </div>
    </div>

  </div>
</ion-content>
